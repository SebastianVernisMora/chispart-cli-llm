#!/bin/bash

# Script para iniciar la interfaz web en Termux
# Optimizado para dispositivos mÃ³viles

# Detectar la ubicaciÃ³n del script
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Si estamos en ~/bin, el proyecto deberÃ­a estar en ~/cli-universal-llms
if [[ "$SCRIPT_DIR" == *"/bin" ]]; then
    PROJECT_DIR="$HOME/cli-universal-llms"
else
    PROJECT_DIR="$SCRIPT_DIR"
fi

# Verificar que el proyecto existe
if [ ! -f "$PROJECT_DIR/app.py" ]; then
    echo "âŒ Error: No se encontrÃ³ el proyecto CLI Universal LLMs"
    echo "   Esperado en: $PROJECT_DIR"
    exit 1
fi

cd "$PROJECT_DIR"

# Verificar dependencias
if ! python -c "import flask" 2>/dev/null; then
    echo "âŒ Error: Flask no estÃ¡ instalado"
    echo "   Ejecuta: pip install flask"
    exit 1
fi

# Obtener la IP local para mostrar al usuario
LOCAL_IP=$(ip route get 1.1.1.1 | grep -oP 'src \K\S+' 2>/dev/null || echo "localhost")

echo "ğŸŒ Iniciando CLI Universal LLMs - Interfaz Web"
echo "=============================================="
echo ""
echo "ğŸ“± Acceso local:"
echo "   http://localhost:5000"
echo "   http://127.0.0.1:5000"
echo ""
echo "ğŸŒ Acceso desde otros dispositivos:"
echo "   http://$LOCAL_IP:5000"
echo ""
echo "ğŸ’¡ Consejos para Termux:"
echo "   â€¢ MantÃ©n la pantalla encendida para evitar que se cierre"
echo "   â€¢ Usa el navegador de tu telÃ©fono para acceder"
echo "   â€¢ Puedes acceder desde otros dispositivos en la misma red WiFi"
echo ""
echo "ğŸ›‘ Presiona Ctrl+C para detener el servidor"
echo ""

# Configurar variables de entorno para optimizar Flask en Termux
export FLASK_ENV=production
export FLASK_DEBUG=false

# Iniciar la aplicaciÃ³n web
python app.py